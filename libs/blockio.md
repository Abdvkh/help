# BlockIO

This Lib make integration with [block.io](blockio.md) in easy way.

![](../.gitbook/assets/image%20%2838%29.png)

## With Block.io you can

* create new wallets: Bitcoin, Dogecoin, Litecoin
* look transactions
* accept payments
* make withdraws
* etc

## Demo bot

See [DemoBlockIOBot](https://telegram.me/DemoBlockIOBot). It also available in the Store.

See [docs](https://help.bots.business/store/blockiobot) about this bot.



## Initial setup

Need to set Api key and secret pin in first. You can create command `/init` with such BJS:

```javascript
// set secret PIN
Libs.BlockIO.setSecretPin("YOURS SECRET PIN");

Libs.BlockIO.Bitcoin.setApiKey("YOURS_API_KEY for Bitcoin");
Libs.BlockIO.Dogecoin.setApiKey("YOURS_API_KEY for Dogecoin");
Libs.BlockIO.Litecoin.setApiKey("YOURS_API_KEY for Litecoin");

// Testnet
Libs.BlockIO.testNet.Bitcoin.setApiKey("YOURS_API_KEY for Bitcoin");
Libs.BlockIO.testNet.Dogecoin.setApiKey("YOURS_API_KEY for Dogecoin");
Libs.BlockIO.testNet.Litecoin.setApiKey("YOURS_API_KEY for Litecoin");
```

Just run bot and execute this command `/init`. Then you can remove it.

{% hint style="warning" %}
You get Secret PIN from Block.io by e-mail
{% endhint %}

{% hint style="warning" %}
You get API keys in Block.io [dashboard](https://block.io/dashboard) by link "Show API Keys"
{% endhint %}

{% hint style="success" %}
You can also provide pin and api key in commands in options
{% endhint %}

## Methods

All methods from [https://block.io/api](https://block.io/api/simple/) available in the Lib.

You can run it via command:

```javascript
Libs.BlockIO.XXXcoin.methodYYY(
    { onSuccess: "/onNewAddress",
      onError: "/onerror",
      // ....
      // OTHER POSSIBLE PARAMS - see are later
} );
```

{% hint style="info" %}
XXXCoin - it is Bitcoin, Litecoin or Dogecoin 
{% endhint %}

{% hint style="success" %}
You can also use Testnet: Libs.BlockIO.testNet.XXXcoin
{% endhint %}

### All methods

<table>
  <thead>
    <tr>
      <th style="text-align:left">Method name for
        <br />Libs.BlockIO.XXXcoin</th>
      <th style="text-align:left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align:left">getNewAddress</td>
      <td style="text-align:left">Returns a newly generated address, and its unique(!) label generated by
        Block.io. You can optionally specify a custom label.</td>
    </tr>
    <tr>
      <td style="text-align:left">getBalance</td>
      <td style="text-align:left">Returns the balance of your entire Bitcoin, Litecoin, or Dogecoin account
        (i.e., the sum of balances of all addresses/users within it) as numbers
        to 8 decimal points, as strings.</td>
    </tr>
    <tr>
      <td style="text-align:left">getAddressBalance</td>
      <td style="text-align:left">
        <p>Returns the balance of the specified addresses, or labels. Upto 2500 addresses/labels
          can be specified per request.
          <br />
        </p>
        <p>Can be used to query balances for external (non-account) addresses. If
          an external address&apos; balance is returned, its <em>user_id</em> and <em>label</em> fields
          will be <em>null</em>.</p>
      </td>
    </tr>
    <tr>
      <td style="text-align:left">getMyAddresses</td>
      <td style="text-align:left">Returns the (unarchived) addresses, their labels, user ids, and balances
        on your account. Upto 2500 addresses per page. Page parameter is optional.</td>
    </tr>
    <tr>
      <td style="text-align:left">getAddressByLabel</td>
      <td style="text-align:left">Returns the address specified by a label.</td>
    </tr>
    <tr>
      <td style="text-align:left">isValidAddress</td>
      <td style="text-align:left">Returns whether a single specified address is valid for the network, or
        not.</td>
    </tr>
    <tr>
      <td style="text-align:left">archiveAddresses</td>
      <td style="text-align:left">Archives upto 100 addresses in a single API call. Addresses can be specified
        by their labels.</td>
    </tr>
    <tr>
      <td style="text-align:left">unarchiveAddresses</td>
      <td style="text-align:left">Unarchives upto 100 addresses in a single API call. Addresses can be specified
        by their labels.</td>
    </tr>
    <tr>
      <td style="text-align:left">getMyArchivedAddresses</td>
      <td style="text-align:left">Returns all the <em>archived</em> addresses, their labels, and user ids
        on your account.</td>
    </tr>
    <tr>
      <td style="text-align:left">getTransactions</td>
      <td style="text-align:left">
        <p>Returns various data for the last 25 transactions spent or received. You
          can optionally specify a <em>before_tx</em> parameter to get earlier transactions.</p>
        <p></p>
        <p>You can use this method to query for addresses that are not on your account.</p>
      </td>
    </tr>
    <tr>
      <td style="text-align:left">getRawTransaction</td>
      <td style="text-align:left">Returns the raw data, including transaction hex, for a given transaction
        ID.</td>
    </tr>
    <tr>
      <td style="text-align:left">getNetworkFeeEstimate</td>
      <td style="text-align:left">Estimates the Network Fee you will need to pay when you make a withdrawal
        request. The Network Fee is required by the Bitcoin/Dogecoin/etc. networks,
        not Block.io.</td>
    </tr>
    <tr>
      <td style="text-align:left">isGreenTransaction</td>
      <td style="text-align:left">Returns an array of transactions that were sent by Block.io Green Addresses.
        Funds sent from Green Addresses are guaranteed by Block.io, and can be
        used immediately on receipt with zero network confirmations.</td>
    </tr>
    <tr>
      <td style="text-align:left">getCurrentPrice</td>
      <td style="text-align:left">Returns the prices from the largest exchanges for Bitcoin, Dogecoin, or
        Litecoin, specified by the API Key. Specifying the base currency is optional.</td>
    </tr>
    <tr>
      <td style="text-align:left">withdraw</td>
      <td style="text-align:left">Withdraws amount of coins from any addresses in your account to up to
        2500 destination addresses.</td>
    </tr>
    <tr>
      <td style="text-align:left">withdrawFromAddresses</td>
      <td style="text-align:left">Withdraws AMOUNT coins from upto 2500 addresses at a time, and deposits
        it to up to 2500 destination addresses.</td>
    </tr>
    <tr>
      <td style="text-align:left">withdrawFromLabels</td>
      <td style="text-align:left">Withdraws AMOUNT coins from upto 2500 labels at a time, and deposits it
        to upto 2500 destination addresses, or labels.</td>
    </tr>
  </tbody>
</table> Full methods docs [here](https://block.io/api/)

So if you need, for example, getTransactions method for Litecoin change this code:

```javascript
Libs.BlockIO.XXXcoin.methodYYY(
    { onSuccess: "/onNewAddress",
      onError: "/onerror",
      // ....
      // OTHER POSSIBLE PARAMS
} );
```

to:

```javascript
Libs.BlockIO.Litecoin.getTransactions(
    { onSuccess: "/onGetTransaction",
      onError: "/onerror",
      // ....
      // OTHER POSSIBLE PARAMS
} );
```

### What it is - "OTHER POSSIBLE PARAMS" ?

It can be:

* api\_key and pin. If you do not set [here](https://help.bots.business/libs/blockio#initial-setup)  \(for all methods\)
* label, address \(for getNewAddress methods and etc\)
* labels, addresses
* to\_addresses, from\_addresses, from\_labels \(for withdraw \)
* page
* transaction\_ids \(for isGreenTransaction method\)
* type \(for getTransactions method\)

{% hint style="info" %}
See available params in [https://block.io/api](https://block.io/api/) page
{% endhint %}

### 

### Example for getNewAddress

For example: "Actions for Handling Addresses"

From block.io [help](https://block.io/api/): 

![from Block.io help - https://block.io/api](../.gitbook/assets/image%20%2834%29.png)

So we have API method "Get New Address":

```javascript
Libs.BlockIO.Bitcoin.getNewAddress(
    { onSuccess: "/onNewAddress",
      onError: "/onerror"
} );
```

This function getNewAddress have 2 callbacks: `onSuccess` and `onError`.

`onSuccess` callback command `/onNewAddress` will be runned:

```javascript
let wallet = options;  // we have Block.io response in options

// uncomment this line for inspecting all options
// Bot.sendMessage(inspect(options));

Bot.sendMessage(
    "*New wallet* was created. \n  #‚É£Wallet: `" + 
    wallet.address + "`\n  üè∑Label: `" +
    wallet.label + "`"
);
```



### Example for making Withdraw

![from Block.io help - https://block.io/api](../.gitbook/assets/image%20%2811%29.png)

{% hint style="success" %}
We know about params: `to_addresses` and `from_labels` from block.io [help](https://block.io/api/). See "Withdraw From Labels" method there
{% endhint %}

Transfer coin from Block.io wallet with label "default" to any wallet:

```javascript
Libs.BlockIO.Bitcoin.withdrawFromLabels(
    { to_addresses:"3KyRZdjJCpHjHfnjaELvrDpNAxUE3D1NK4",
      from_labels:"default",
      amounts:0.002,
      onSuccess: "/onwithdraw", onError: "/onerror"
});
```

onWithdraw command: 

```javascript
Bot.sendMessage(inspect(options))
```

### 

### Error handing

You can show error message from Block.io

```javascript
Bot.sendMessage("Error");

if(options&&options.data){
  Bot.sendMessage(options.data.error_message);
}

```



## How to...

### Open new BTC address for each user \(chat\)?

possible BJS for command /newAddress:

```javascript
Libs.BlockIO.Bitcoin.getNewAddress(
    { 
      label: "chat" + chat.chatid,
      onSuccess: "/onNewAddress",
      onError: "/onError",
} );
```

command /onNewAddress:

```javascript
Bot.sendMessage(inspect(options));
Bot.sendMessage("Created: " + options.address);
```

command /onError:

```javascript
Bot.sendMessage("Error happens on wallet creation");
```



### How can I check any payment by user on [block.io](http://block.io/) if I know him bitcoin address and payment will be 0,0001 Bitcoin?

Looks like you need to receive payments on one own wallet from several users. 

It is bad practice:

1. User must say his wallet before payment. Because after payment anybody can see any addresses in blockchain
2. User can do mistake with his address wallet
3. User can do mistake with amount

{% hint style="danger" %}
Thus, users will have incorrect operations. You should check them in manual mode. It will be very difficult for you to verify incorrect transactions in the blockchain.
{% endhint %}

More good practice it is generate new income address for each payment. It is more secure. 















